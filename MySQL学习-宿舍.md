4 varchar(n) 中 n 最大取值为多少？

MySQL 规定除了 TEXT、BLOBs 这种大对象类型之外，其他所有的列(不包括隐藏列和记录头信息，但是包含变长字段长度列表和NULL值列表)占用的字节长度加起来不能超过 65535 个字节。即一行记录除了 TEXT、BLOBs 类型的列，限制最大为 65535 字节，注意是一行的总长度，不是一列。

**①单字段**-取决于用什么样的字符集，如果是单字节的话，就直接用65535-变长字段长度-NULL值列表长度；如果是多字节的话，比如UTF-8，每个字符占据3个字节，就要用65535/3-变长字段长度-NULL值列表长度。【其中，如果变长字段允许存储的最大字节数小于255字节，则变长字段长度为1字节；反之大于255字节时，就用2字节表示；NULL值列表长度都是1字节】

**②多字段**-要确保所有字段长度+变长字段字节数列表占用的字节数+NULL值列表占用的字节数<=65535

5 行溢出的话MySQL怎么处理呢？

答：InnoDB 存储引擎的Compact行格式通过使用**溢出页**来避免行溢出，允许表行大小超过 65,535 字节，但某些字段可能会被移动到外部页面存储到溢出页中，同时在原始数据页的真实数据处用20字节指向溢出页的地址。Compressed 和 Dynamic 这两个行格式，则直接在数据页中存储溢出页的地址，把所有的数据都放到溢出页中。

6 MySQL如何存放NULL值？

答：Compact行格式不直接在真实数据中存储，而是通过NULL值列表标记数值为NULL的列。NULL值列表占据1字节，如果全部数据没有NULL值，则可以直接省略这个列表。

## 索引篇

### 一、索引常见面试题

#### 1 什么是索引？

答：帮助存储引擎快速获取数据的一种数据结构，即索引是数据的目录。

存储引擎就是如何存储数据、如何为存储的数据建立索引、如何更新、查询数据等技术的实现方法。

#### 2 索引的分类

**①按数据结构**-B+树索引、Hash索引、Full-text索引

1>InnoDB根据不同的场景选择不同的列作为索引

**有主键**：默认使用主键作为聚簇索引的索引键

**没有主键**：选择第一个不包含NULL值的唯一列作为聚簇索引的索引键

**既没有主键也没有不包含NULL值的唯一列**：自动生成隐式自增id作为聚簇索引的索引键

2>什么是B+树呢？

**B+树是一种多叉树**，叶子节点存放数据，每个节点里的数据按主键顺序存放，非叶子节点存放索引。每一层父节点索引值都会出现在下层子节点索引值中，最终叶子节点中包括了所有索引值信息。每个叶子节点有两个指针，分别指向下一个叶子节点和上一个叶子节点，形成双向链表。

3>如何使用主键查询数据？

**查询索引**-从主键索引的根节点查找，遍历非叶子节点；**定位叶子节点**-在非叶子节点的遍历过程中，不断选择合适分支，逐步向下遍历，直到到达叶子节点；**返回数据**-B+ 树索引提供最终数据在数据页中的位置，由MySQL根据这个位置去数据文件中读取实际的数据行。

读取一次节点就是一次磁盘I/O操作。B+树相比B树和二叉树优势在于查询效率很高。

4>二级索引查询数据

**主键索引**-B+树叶子节点存放完整的数据记录

**二级索引**-B+树叶子节点存放主键的值

定位到叶子节点后获得的是主键值，再通过主键索引的B+树查询到对应的叶子节点，从而获得整行数据。该过程称为“**回表**”，总共经历两个B+树查询到数据。但是假如二级索引叶子节点保存的值就是要查询的数据，就不用再回表了，该过程称为“**覆盖索引**”。

5>为什么选择B+树作为索引的数据结构？

**B+树 vs B树**：B+树只在叶子节点存储数据，因此单个节点数据量更小，相同I/O次数下可查询更多节点；B+树叶子节点是双向链表连接，适用于基于范围的顺序查找。

**B+树 vs 二叉树**：B+树的父节点允许最大子节点数为d个，从而搜索复杂度为O(log_d N)，即使千万级别的数据也可以在3-4次I/O操作内完成查询；而二叉树每个父节点的子节点数只能是2个，即搜索复杂度为O(log_2 N)。

**B+树 vs Hash索引**：Hash索引进行等值查询时，搜索复杂度是O(1)；但它不适合做范围查询，应用范围较小。

**②按物理存储**-聚簇索引(主键索引)、二级索引(辅助索引)

具体内容详见“2→①→4>二级索引查询数据”的回表和覆盖索引

**③按字段特性**-主键索引、唯一索引、普通索引、前缀索引

**主键索引**-一张表最多只有一个主键索引，一般随表一起创建，索引列不允许有空值。

**唯一索引**-建立在UNIQUE字段上的索引，一张表可以有多个唯一索引，索引列的值必须唯一但可以有空值。

**普通索引**-既不要求字段是主键，也不要求字段是UNIQUE

**前缀索引**-对字符类型字段的前几个字符建立索引，减少索引占用的存储空间，提升查询效率。

**④按字段个数**-单列索引、联合索引

1>**联合索引**-建立在多列上的索引，即通过将多个字段组合成一个索引。此时的非叶子节点将存储一个联合索引内所有的字段，但仍然不存储真实数据，只存储字段名。使用联合索引查询数据时，将先查询A字段，A字段相同的情况下再查询B字段，这称为“**最左匹配原则**”。如果查询时不满足该原则，即不查询A直接从B开始查询，联合索引将失效，因为**B是全局无序局部相对有序的**。因此，**利用索引的前提是索引里的key是有序的**。

2>联合索引范围查询